import pandas as pd

def compare_sheets(file1, file2):
    # Load the Excel files
    excel1 = pd.ExcelFile(file1)
    excel2 = pd.ExcelFile(file2)

    # Get the list of sheet names
    sheets1 = set(excel1.sheet_names)
    sheets2 = set(excel2.sheet_names)

    # Get common sheets
    common_sheets = sheets1.intersection(sheets2)

    if not common_sheets:
        raise ValueError("No common sheets found in the two Excel files.")

    # Compare each common sheet
    for sheet in common_sheets:
        df1 = pd.read_excel(file1, sheet_name=sheet)
        df2 = pd.read_excel(file2, sheet_name=sheet)

        # Reindex to ensure they have the same columns
        common_columns = df1.columns.union(df2.columns)
        df1 = df1.reindex(columns=common_columns)
        df2 = df2.reindex(columns=common_columns)

        # Compare the DataFrames
        comparison_result = df1.compare(df2)

        # Write the differences to a new Excel file (one per sheet)
        output_file = f'comparison_result_{sheet}.xlsx'
        comparison_result.to_excel(output_file, index=True)
        print(f"Comparison complete for sheet '{sheet}'. Differences are written to '{output_file}'.")

# Specify your file paths
file1 = 'dataV4.xlsx'
file2 = 'dataV5.xlsx'

# Run the comparison
compare_sheets(file1, file2)
